---
title: "child"
author: "sl team"
date: "4/26/2020"
output: html_document
---

```{r, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE)
fam <- families[k]

```


## `r gsub("_", " ", fam)`  {.tabset  .tabset-pills}

### Time trends

#### National aggregates

```{r, echo = FALSE, fig.cap="Average responses for a given day (dot) with 95% confidence intervals (whiskers)", message = FALSE, warning = FALSE}

plot_aggregates(my_data, filter(my_vars, family == fam & !is.na(variable)))

```

#### Broken down by `r group`


```{r, echo = FALSE, fig.cap="Disaggregated average responses for a given day (dot) with 95% confidence intervals (whiskers)", fig.height = length(vars)*1.42 + 1, fig.width = (unique(my_data$id) %>% length)*1.1, message = FALSE, warning = FALSE}

plot_disaggregates(my_data, filter(my_vars, family == fam & !is.na(variable)))

```



### Current averages

```{r, echo = FALSE}

current_means <- my_data[, c("id", "date", vars)] %>%
 filter(date == max(date)) %>%
 group_by(id, date)  %>%
 summarise_all( function(x)  mean(x, na.rm = T)) 

current_means %>% 
  
 kable(caption = paste("Mean responses in each ", group, " (most recent date)"), 
       col.names = c(group, "Date", var_labs), 
       digits = 2)

```


<!-- Optionally add maps -->

```{r, child = add_mapsRmd, echo = FALSE, eval = add_maps}

```


### Definitions of measures

```{r, echo = FALSE, warning = FALSE}

my_vars %>% 
  filter(family == fam) %>% select(short_label, description) %>% 
  kable(caption = "Data definitions", col.names = c("Measure", "Definition"))

```

```{r, include = FALSE}
k <- k+1
```

```{r, child = childRmd, echo = FALSE, eval = k <= n_families}

```
